const n="pwa-cache-v1",a=["/easy-messenger/img/logo-512.png","/easy-messenger/img/logo-128.png","/easy-messenger/img/logo-192.png"];self.addEventListener("install",(e=>{console.log("Service Worker Installed!"),self.skipWaiting(),e.waitUntil(caches.open(n).then((e=>e.addAll(a))))})),self.addEventListener("activate",(e=>(console.log("Service Worker Activated!"),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==n)).map((e=>caches.delete(e))))))),self.clients.claim()))),self.addEventListener("fetch",(e=>{e.respondWith(fetch(e.request).then((t=>caches.open(n).then((s=>(s.put(e.request,t.clone()),t))))).catch((()=>caches.match(e.request))))})),self.addEventListener("push",(async function(e){console.log("Push notification received:",e);const t=e.data?e.data.text():"send";let s="'_'";if(s="send"===t?"A user has sent a message (click to view)!":"delete-all-messages"===t?"All chat messages have been deleted.":"message-deleted"===t?"A message has been deleted.":"chat-deleted"===t?"A chat has been deleted.":t,!(await self.clients.matchAll({type:"window",includeUncontrolled:!0})).some((e=>e.focused))){const t={body:s,icon:"https://manuelwestermeier.github.io/easy-messenger/img/logo-512.png",title:"New Message",tag:"message-notification",vibration:[200,100,200],sound:"https://manuelwestermeier.github.io/easy-messenger/sounds/messager-ringtone.mp3",renotify:!0,silent:!1,timestamp:Date.now()};e.waitUntil(self.registration.showNotification(t.title,t))}})),self.addEventListener("notificationclick",(function(e){e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then((e=>{for(let t of e)if(t.url.includes("/easy-messenger/")&&"focus"in t)return t.focus();return clients.openWindow("https://manuelwestermeier.github.io/easy-messenger/")})))})),self.addEventListener("message",(e=>{"skipWaiting"===e.data&&self.skipWaiting()}));