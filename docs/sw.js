const i="pwa-cache-v1",a=["/easy-messenger/","/easy-messenger/style.css","/easy-messenger/script.js","/easy-messenger/manifest.json","/easy-messenger/service-worker.json","/easy-messenger/img/logo-512.png","/easy-messenger/img/logo-128.png","/easy-messenger/img/logo-192.png"];self.addEventListener("install",e=>{console.log("Service Worker Installed!"),self.skipWaiting(),e.waitUntil(caches.open(i).then(t=>t.addAll(a)))});self.addEventListener("activate",e=>(console.log("Service Worker Activated!"),e.waitUntil(caches.keys().then(t=>Promise.all(t.filter(s=>s!==i).map(s=>caches.delete(s))))),self.clients.claim()));self.addEventListener("fetch",e=>{e.respondWith(fetch(e.request).then(t=>caches.open(i).then(s=>(s.put(e.request,t.clone()),t))).catch(()=>caches.match(e.request)))});self.addEventListener("push",async function(e){console.log("Push notification received:",e);const t=e.data?e.data.text():"send";let s="'_'";if(t==="send"?s="A user has sent a message (click to view)!":t==="delete-all-messages"?s="All chat messages have been deleted.":t==="message-deleted"?s="A message has been deleted.":t==="chat-deleted"?s="A chat has been deleted.":s=t,!(await self.clients.matchAll({type:"window",includeUncontrolled:!0})).some(n=>n.focused)){const n={body:s,icon:"https://manuelwestermeier.github.io/easy-messenger/img/logo-512.png",title:"New Message",tag:"message-notification",vibration:[200,100,200],sound:"https://manuelwestermeier.github.io/easy-messenger/sounds/messager-ringtone.mp3",renotify:!0,silent:!1,timestamp:Date.now()};e.waitUntil(self.registration.showNotification(n.title,n))}});self.addEventListener("notificationclick",function(e){e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then(t=>{for(let s of t)if(s.url.includes("/easy-messenger/")&&"focus"in s)return s.focus();return clients.openWindow("https://manuelwestermeier.github.io/easy-messenger/")}))});
